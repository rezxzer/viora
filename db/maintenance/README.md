# Database Maintenance Scripts

ეს ფაილები გამოიყენება Supabase-ში ვიდეო ავტვირთვის სისტემის გასასწორებლად.

## ფაილების აღწერა

### 1. `040_check_storage_buckets.sql`

- შეამოწმებს და შექმნის `post-media` და `avatars` storage bucket-ებს
- დააყენებს ფაილების ზომის ლიმიტებს (15MB ვიდეოებისთვის, 5MB სურათებისთვის)
- ნებართავს ვიდეო და სურათ ფაილების ტიპებს

### 2. `050_fix_post_assets_table.sql`

- შეამოწმებს და გაასწორებს `post_assets` ცხრილის სტრუქტურას
- დაამატებს აკლია სვეტებს (id, mime_type, created_at)
- შექმნის საჭირო ინდექსებს

### 3. `060_fix_storage_policies.sql`

- გაასწორებს storage policies-ებს `post-media` და `avatars` bucket-ებისთვის
- ნებართავს მომხმარებლებს ატვირთონ ფაილები მათ საკუთარ ფოლდერში
- ნებართავს ყველას წაიკითხოს ატვირთული ფაილები

### 4. `070_check_posts_table.sql`

- შეამოწმებს და გაასწორებს `posts` ცხრილის სტრუქტურას
- დაამატებს აკლია სვეტებს (image_url, content, author_id, created_at)

### 5. `080_fix_video_upload_system.sql` ⭐ **მთავარი ფაილი**

- **გააკეთებს ყველა ცვლილებას ერთად**
- შეამოწმებს და შექმნის storage bucket-ებს
- გაასწორებს ყველა ცხრილის სტრუქტურას
- გაასწორებს ყველა RLS policy-ს
- შეამოწმებს ყველაფერს verification queries-ებით

## როგორ გამოვიყენოთ

### Supabase Dashboard-ში:

1. გადადით **SQL Editor** განყოფილებაში
2. აირჩიეთ **`080_fix_video_upload_system.sql`** ფაილი (რეკომენდებული)
3. დააჭირეთ **Run** ღილაკს
4. შეამოწმეთ output-ი და დარწმუნდით რომ ყველა ნაბიჯი წარმატებით შესრულდა

### ანალოგიურად:

თუ გსურთ ცალ-ცალკე ფაილების გაშვება:

1. `040_check_storage_buckets.sql` - პირველ რიგში
2. `050_fix_post_assets_table.sql` - მეორე რიგში
3. `060_fix_storage_policies.sql` - მესამე რიგში
4. `070_check_posts_table.sql` - მეოთხე რიგში

## რა ხდება ამ ფაილების გაშვების შემდეგ

✅ **Storage Buckets**: შეიქმნება `post-media` და `avatars` bucket-ები  
✅ **Database Tables**: გაასწორდება `posts` და `post_assets` ცხრილები  
✅ **Security Policies**: გაასწორდება RLS policies ფაილების ატვირთვისთვის  
✅ **Video Support**: ვიდეოები შეიძლება ატვირთოს და ნაჩვენები იყოს

## შემოწმება

ფაილების გაშვების შემდეგ შეგიძლიათ შეამოწმოთ:

1. **Feed გვერდზე** გადადით და სცადოთ ვიდეოს ატვირთვა
2. **Supabase Dashboard-ში** Storage განყოფილებაში შეამოწმეთ bucket-ები
3. **Database განყოფილებაში** შეამოწმეთ ცხრილების სტრუქტურა

## პრობლემების შემთხვევაში

თუ რაიმე შეცდომა მოხდა:

1. შეამოწმეთ SQL Editor-ის output-ი
2. დარწმუნდით რომ Supabase-ში admin უფლებები გაქვთ
3. გადატვირთეთ გვერდი და კვლავ სცადეთ ვიდეოს ატვირთვა

---

**შენიშვნა**: ეს ფაილები idempotent არიან, რაც ნიშნავს რომ მათი მრავალჯერადი გაშვება უსაფრთხოა და არ გამოიწვევს შეცდომებს.
